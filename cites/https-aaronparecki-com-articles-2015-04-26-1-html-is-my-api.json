{"type":["h-cite"],"properties":{"url":["https://aaronparecki.com/articles/2015/04/26/1/html-is-my-api"],"published":["2015-04-27T04:48:00Z"],"content":["In August 2012, I wrote a quick script to stream front-page Hackernews stories to an IRC channel on Freenode (##hackernews in case you're interested) so that I could quickly glance at popular stories there instead of needing to load Hackernews. Since IRC is my feed reader, I've always tried to pipe as much there as possible. \n\n Parsing the Hackernews front page HTML \n\n In 2012 there was no API for Hackernews, so my only option was to use one of the unofficial ones, or read the HTML from the front page myself. I opted to parse the HTML directly since it wasn't super complex. I know you shouldn't parse HTML with a regex, but I did anyway. It worked great, from August 2012 up until April 2015. \n\n Finally this month I stopped seeing updates in the channel, and went to take a look. It appears they made a slight change to the HTML which of course broke my regex, since I was matching against some specific markup. I also learned from someone else in the channel, that Hackernews had launched an official JSON API in October. I decided to rewrite the code to work with that API rather than try to update my regex. \n\n Switching to the JSON API \n\n It took only a few minutes to rewrite the script using two endpoints, topstories.json and fetching an item. However, within two days, I had already encountered a problem. The IRC bot started spitting out empty lines in IRC, one for each front-page story. My code was by no means foolproof, and I realized that this would happen if the API call to fetch story details returned an empty result. \n\n So in 2.5 years of parsing the HTML, I never had any problems. In 2 days of parsing the JSON API, I hit a glitch where all the stories were empty. \n\n 2015-04-26 19:43:03     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:06     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:08     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:11     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:14     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:17     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id=\n2015-04-26 19:43:20     Loqi    [hackernews]  ( points) https://news.ycombinator.com/item?id= \n\n Make the visible data machine readable \n\n Since more people and programs see the HTML than use the API, the HTML ends up being more reliable. Luckily there's a simple solution to avoid nasty regex parsing hacks in order to be able to generate a machine-readable (and JSON!) version of an HTML page. It requires the author of the HTML to add a few classes to their existing markup. We'll use the Hackernews front page markup as an example. \n\n Here's a snippet of HTML from the current Hackernews front page for a single story. \n\n &lt;tr class=\"athing\"&gt;\n  &lt;td align=\"right\" valign=\"top\" class=\"title\"&gt;\n    &lt;span class=\"rank\"&gt;19.&lt;/span&gt;\n  &lt;/td&gt;\n  &lt;td&gt;\n    &lt;center&gt;&lt;a id=\"up_9443241\" onclick=\"return vote(this)\" href=\"vote?for=9443241&amp;amp;dir=up&amp;amp;auth=4f617c803a44687927291cd133ac825ca9e61c4b&amp;amp;goto=news\"&gt;&lt;div class=\"votearrow\" title=\"upvote\"&gt;&lt;/div&gt;&lt;/a&gt;&lt;/center&gt;\n  &lt;/td&gt;\n  &lt;td class=\"title\"&gt;\n    &lt;span class=\"deadmark\"&gt;&lt;/span&gt;\n    &lt;a href=\"http://www.dmiller.io/blog/2015/4/26/comparing-the-php7-and-hack-type-systems\"&gt;Comparing the PHP 7 and Hack Type Systems&lt;/a&gt;\n    &lt;span class=\"sitebit comhead\"&gt; (dmiller.io)&lt;/span&gt;\n  &lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n  &lt;td colspan=\"2\"&gt;&lt;/td&gt;\n  &lt;td class=\"subtext\"&gt;\n    &lt;span class=\"score\" id=\"score_9443241\"&gt;40 points&lt;/span&gt;\n    by &lt;a href=\"user?id=jazzdan\"&gt;jazzdan&lt;/a&gt;\n    &lt;a href=\"item?id=9443241\"&gt;7 hours ago&lt;/a&gt;\n    | &lt;a href=\"flag?id=9443241&amp;amp;on=t&amp;amp;dir=down&amp;amp;auth=4f617c803a44687927291cd133ac825ca9e61c4b&amp;amp;goto=news\"&gt;flag&lt;/a&gt;\n    | &lt;a href=\"item?id=9443241\"&gt;20 comments&lt;/a&gt;\n  &lt;/td&gt;\n&lt;/tr&gt;\n \n\n If this looks like a chunk of HTML you don't want to touch with a 10-foot pole, I don't blame you. In order to make this easily machine-readable, without requiring custom parsing of HTML, we can add a few Microformats classes to turn these into h-entry posts. \n\n First, wrap both table rows with a &lt;tbody&gt; tag with a class of h-entry in order to group these rows into a single element. (And yes, it's okay for a table to have multiple tbody tags.) \n\n &lt;tbody class=\"h-entry\"&gt;\n...\n&lt;/tbody&gt; \n\n Find the line that contains the permalink to the story as well as the name, and add the u-url and p-name classes: \n\n &lt;a class=\"u-url p-name\" href=\"http://www.dmiller.io/blog/2015/4/26/comparing-the-php7-and-hack-type-systems\"&gt;Comparing the PHP 7 and Hack Type Systems&lt;/a&gt; \n\n Find the link to the person who submitted the post, and add the p-author class: \n\n by &lt;a class=\"p-author h-card\" href=\"user?id=jazzdan\"&gt;jazzdan&lt;/a&gt; \n\n Lastly, indicate the time the post was created as well as the post's permalink on news.ycombinator.com: \n\n &lt;a class=\"u-url\" href=\"item?id=9443241\"&gt;&lt;time datetime=\"2015-04-26T14:15:00-0700\" class=\"dt-published\"&gt;7 hours ago&lt;/time&gt;&lt;/a&gt; \n\n Here's a summary of the changes in colorized diff format. You can see the additions are extremely minor, and didn't involve changing the structure of the HTML with the exception of adding the &lt;tbody&gt; tag. \n\n \n    \n                              \n                              @@ -1,3 +1,4 @@\n                            \n                                \n                                +&lt;tbody class=\"h-entry\"&gt;\n\n                            \n                                \n                                 &lt;tr class=\"athing\"&gt;\n\n                            \n                                \n                                   &lt;td align=\"right\" valign=\"top\" class=\"title\"&gt;\n\n                            \n                                \n                                     &lt;span class=\"rank\"&gt;19.&lt;/span&gt;\n\n                            \n                              \n                              @@ -7,7 +8,7 @@\n                            \n                                \n                                   &lt;/td&gt;\n\n                            \n                                \n                                   &lt;td class=\"title\"&gt;\n\n                            \n                                \n                                     &lt;span class=\"deadmark\"&gt;&lt;/span&gt;\n\n                            \n                                \n                                -    &lt;a href=\"http://www.dmiller.io/blog/2015/4/26/comparing-the-php7-and-hack-type-systems\"&gt;Comparing the PHP 7 and Hack Type Systems&lt;/a&gt;\n\n                            \n                                \n                                +    &lt;a class=\"u-url p-name\" href=\"http://www.dmiller.io/blog/2015/4/26/comparing-the-php7-and-hack-type-systems\"&gt;Comparing the PHP 7 and Hack Type Systems&lt;/a&gt;\n\n                            \n                                \n                                     &lt;span class=\"sitebit comhead\"&gt; (dmiller.io)&lt;/span&gt;\n\n                            \n                                \n                                   &lt;/td&gt;\n\n                            \n                                \n                                 &lt;/tr&gt;\n\n                            \n                              \n                              @@ -15,9 +16,10 @@\n                            \n                                \n                                   &lt;td colspan=\"2\"&gt;&lt;/td&gt;\n\n                            \n                                \n                                   &lt;td class=\"subtext\"&gt;\n\n                            \n                                \n                                     &lt;span class=\"score\" id=\"score_9443241\"&gt;40 points&lt;/span&gt; \n\n                            \n                                \n                                -    by &lt;a href=\"user?id=jazzdan\"&gt;jazzdan&lt;/a&gt; \n\n                            \n                                \n                                -    &lt;a href=\"item?id=9443241\"&gt;7 hours ago&lt;/a&gt;\n\n                            \n                                \n                                +    by &lt;a class=\"p-author h-card\" href=\"user?id=jazzdan\"&gt;jazzdan&lt;/a&gt; \n\n                            \n                                \n                                +    &lt;a class=\"u-url\" href=\"item?id=9443241\"&gt;&lt;time datetime=\"2015-04-26T14:15:00-0700\" class=\"dt-published\"&gt;7 hours ago&lt;/time&gt;&lt;/a&gt;\n\n                            \n                                \n                                     | &lt;a href=\"flag?id=9443241&amp;amp;on=t&amp;amp;dir=down&amp;amp;auth=4f617c803a44687927291cd133ac825ca9e61c4b&amp;amp;goto=news\"&gt;flag&lt;/a&gt;\n\n                            \n                                \n                                     | &lt;a href=\"item?id=9443241\"&gt;20 comments&lt;/a&gt;\n\n                            \n                                \n                                   &lt;/td&gt;\n\n                            \n                                \n                                -&lt;/tr&gt;\n                            \n                                \n                            \n                                \n                                +&lt;/tr&gt;\n\n                            \n                                \n                                +&lt;/tbody&gt;\n                            \n                                \n                             \n\n   \nWhat does this give us? If you run the new HTML through a microformats parser (online, PHP, Ruby, Python, Node.js), then the result is a data structure representing the item! \n\n {\n  \"items\": [\n    {\n      \"type\": [\n        \"h-entry\"\n      ],\n      \"properties\": {\n        \"author\": [\n          {\n            \"type\": [\n              \"h-card\"\n            ],\n            \"properties\": {\n              \"name\": [\n                \"jazzdan\"\n              ],\n              \"url\": [\n                \"http:\\/\\/news.ycombinator.com\\/user?id=jazzdan\"\n              ]\n            },\n            \"value\": \"jazzdan\"\n          }\n        ],\n        \"name\": [\n          \"Comparing the PHP 7 and Hack Type Systems\"\n        ],\n        \"url\": [\n          \"http:\\/\\/www.dmiller.io\\/blog\\/2015\\/4\\/26\\/comparing-the-php7-and-hack-type-systems\",\n          \"http:\\/\\/news.ycombinator.com\\/item?id=9443241\"\n        ],\n        \"published\": [\n          \"2015-04-26T14:15:00-0700\"\n        ]\n      }\n    }\n  ]\n} \n\n This means consuming code can rely on a Microformats parser to deal with the (potentially messy) HTML, and only needs to handle the well-structured output that you see above. \n\n If Hackernews were to add this markup to the front page, it would give people an easy way to parse the stories. This would enable me to add Hackernews to my IndieWeb reader, as well as give me an easy way to stream the front-page stories to IRC, while not relying on a third-party API. \n\n IndieWebCamp \n\n For more about how we're using Microformats to enable cross-site following, commenting and other interactions, check out the IndieWebCamp wiki! \n\n You might also like to join us for an IndieWebCamp in DÃ¼sseldorf, Portland, or Edinburgh! \n\n \n.code-wrapper {\n    overflow-x: auto;\n    border: 1px #eeeeff solid;&amp;lt;br /&amp;gt;\n}\n.diff-table {\n    width: 100%;\n    white-space: nowrap;\n    border-collapse: separate;\n    font-family: Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n}\n.diff-table td {\n    font-size: 12px;\n    line-height: normal;\n}\n.blob-code-hunk, .blob-code-expandable {\n  padding-top: 4px;\n  padding-bottom: 4px;\n  background-color: #f8fafd;\n  border-width: 1px 0;\n}\n.blob-num-addition {\n  background-color: #dbffdb;\n  border-color: #c1e9c1;\n}\n.blob-code-addition {\n  background-color: #eaffea;\n}\n.blob-code-addition .x {\n  background-color: #a6f3a6;\n}\n.blob-num-deletion {\n  background-color: #ffdddd;\n  border-color: #f1c0c0;\n}\n.blob-code-deletion {\n  background-color: #ffecec;\n}"],"author":["https://aaronparecki.com/"]}}